<html>
	<head>
		<title>ATKDEF - Analysis Tool Kit for Deciphering Encrypted Files</title>

		<script type="text/javascript" data-main="js/main" src="js/lib/require.js"></script>
		<link rel="stylesheet/less" type="text/css" href="less/main.less" />
		<script type="text/javascript" src="js/lib/less.min.js"></script>

	</head>

	<body>
		<div id="filePanel">

			<table id="fileTable">
				<tbody data-bind="foreach: files, attr: { 'data-filter': fileFilter }">
					<tr data-bind="css: {selected: $root.selectedFile() === $data, plainText: isPlainText(), cipherText: isCipherText()}, click: function() { $root.selectedFile($data) }">
						<td data-bind="text: name"></td>
					</tr>
				</tbody>
			</table>

			<div class="controls">
				<button data-bind="click: compose(addFiles, selectFiles)">Add Files</button>
				<button data-bind="click: compose(deleteFile, selectedFile), enable: selectedFile">Delete</button>
				<a class="button" data-bind="attr: { href: _.result(selectedFile(), 'toURL'), download: _.result(selectedFile(), 'name'), disabled: !selectedFile()}">Download</a>
				<button data-bind="click: compose(addFileComponent, selectedFile), enable: selectedFile">Add Component</button>

				<label>Filter:
					<select id="fileFilter" data-bind="value: fileFilter">
						<option>none</option>
						<option value="CipherText">ciphertext</option>
						<option value="PlainText">plaintext</option>
					</select>
				</label>	
			</div>
		</div>

		<div id="workPanel" class="tabbed">
			<ul class="tabs">
				<li class="selected"><a href="#tab_design">Design</a></li>
				<!-- ko foreach: components -->
					<!-- ko foreach: _.keys(panels) -->
						<li><a data-bind="attr: {href: '#tab_' + $parentContext.$index() + '_' + $index()}, text: $data"></a></li>
					<!-- /ko -->
				<!-- /ko -->
			</ul>

			<div id="tab_design">
				<!-- ko foreach: components -->
					<div class="component" data-bind="component: $data">
						<span class="name" data-bind="text:name"></span>
						<ul class="inputs" data-bind="foreach: _.keys(inputs)">
							<li data-bind="text: $data"></li>
						</ul>
						<ul class="outputs" data-bind="foreach: _.keys(outputs)">
							<li data-bind="text: $data"></li>
						</ul>
						<div class="options" data-bind="if: !_.isEmpty(options)">
							<!-- hacky nonsense to keep toggling this purely in view logic -->
							<input data-bind="attr: {id: 'component_options_toggle'+$index()}" type="checkbox" class="show_options" />
							<label data-bind="attr: {for: 'component_options_toggle'+$index()}">options</label>
							<ul data-bind="foreach: _.keys(options)">
								<li>
									<label data-bind="attr: {for: 'component_options_pin'+$parentContext.$index()+'_'+$index()}">p</label>
									<!-- ko template: {name: 'component-option-template' } --><!-- /ko -->
								</li>
							</ul>
						</div>
					</div>
				<!-- /ko -->
			</div>

			<!-- ko foreach: components -->
				<!-- ko foreach: _.keys(panels) -->
					<div data-bind="attr: {id: 'tab_' + $parentContext.$index() + '_' + $index()}">
						<pre data-bind="text: $parent.panels[$data]()" />
					</div>
				<!-- /ko -->
			<!-- /ko -->
		</div>

		<div id="componentPanel">
			<!-- ko foreach: window.components -->
				<button data-bind="text: $data.prototype.name, click: function() { $root.addComponent($data) }"></button>
			<!-- /ko -->
		</div>

		<div id="optionPanel">
			<!-- ko foreach: components -->
			<ul data-bind="foreach: _.keys(options)">
				<li>
					<input data-bind="attr: {id: 'component_options_pin'+$parentContext.$index()+'_'+$index()}" type="checkbox" />
					<!-- ko template: {name: 'component-option-template' } --><!-- /ko -->
				</li>
			</ul>
			<!-- /ko -->
		</div>

		<script type="text/html" id="component-option-template">
			<label>
				<span data-bind="text: $data"></span>
				<input data-bind="componentOption: $parent.options[$data]"/>
			</label>
		</script>
	</body>
</html>